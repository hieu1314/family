<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Upload hình lên Supabase</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  body { font-family: Arial; padding: 20px; }
  #preview { margin-top: 20px; max-width: 300px; }
</style>
</head>
<body>

<h2>Upload hình lên Supabase</h2>

<input type="file" id="fileInput" accept="image/*" />
<button id="uploadBtn">Upload</button>

<img id="preview" />

<script>
  const { createClient } = supabase;

  // KHỞI TẠO CLIENT ĐÚNG CÁCH
  const db = createClient(
    "https://vaotrlttfbkoxnuimdnf.supabase.co",
    "sb_publishable_oMaMCvqnwgKxSw4N4NtkBg_rINxwM80"
  );

  // Preview ảnh
  document.getElementById("fileInput").addEventListener("change", function() {
    const file = this.files[0];
    if (file) {
      document.getElementById("preview").src = URL.createObjectURL(file);
    }
  });

  // Upload ảnh
  document.getElementById("uploadBtn").addEventListener("click", async () => {

   const fileInput = document.getElementById("fileInput");
const file = fileInput.files[0];
if (!file) {
  alert("Bạn chưa chọn file!");
  return;
}

// Up vào folder 'uploadrecent'
const folder = "uploadrecent";
const filePath = `${folder}/${file.name}`;

const { data, error } = await db.storage
  .from("family-photos")
  .upload(filePath, file, { upsert: false });

if (error) {
  console.error(error);
  alert("Upload lỗi: " + error.message);
  return;
}

// Lấy URL public
const { data: urlData } = await db.storage
  .from("family-photos")
  .getPublicUrl(filePath);

document.getElementById("preview").src = urlData.publicUrl;
alert("Upload thành công!");

  });
</script>

</body>
</html>
