<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Upload hình lên Supabase</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<style>
  body { font-family: Arial; padding: 20px; }
  #preview { margin-top: 20px; max-width: 300px; }
</style>
</head>
<body>

<h2>Upload hình lên Supabase</h2>

<!-- Chọn file -->
<input type="file" id="fileInput" accept="image/*" />

<!-- Nút upload -->
<button id="uploadBtn">Upload</button>

<!-- Xem trước ảnh -->
<img id="preview" />

<script>
  // 1. Khởi tạo Supabase
  const supabaseUrl = "https://vaotrlttfbkoxnuimdnf.supabase.co";  // thay YOUR_PROJECT_ID
  const supabaseKey = "sb_publishable_oMaMCvqnwgKxSw4N4NtkBg_rINxwM80";  // Anon key của bạn
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // 2. Hiển thị ảnh preview khi chọn file
  document.getElementById("fileInput").addEventListener("change", function() {
    const file = this.files[0];
    if (file) {
      document.getElementById("preview").src = URL.createObjectURL(file);
    }
  });

  // 3. Upload ảnh
  document.getElementById("uploadBtn").addEventListener("click", async () => {
    const fileInput = document.getElementById("fileInput");
    const file = fileInput.files[0];

    if (!file) {
      alert("Chọn 1 file trước đã!");
      return;
    }

    const folder = "2025";                 // folder trong bucket
    const filePath = `${folder}/${file.name}`;  // VD: 2025/anh1.jpg

    // 4. Upload lên Storage
    const { data, error } = await supabase.storage
      .from("family-photos")               // tên bucket của bạn
      .upload(filePath, file);

    if (error) {
      console.error("Upload lỗi:", error);
      alert("Upload thất bại!");
      return;
    }

    // 5. Lấy URL để xem hình (nếu bucket Private → bạn dùng signed URL)
    const { data: urlData } = await supabase.storage
      .from("family-photos")
      .getPublicUrl(filePath);

    alert("Upload thành công!");
    console.log("URL hình:", urlData.publicUrl);

    // Preview URL thực tế sau khi upload
    document.getElementById("preview").src = urlData.publicUrl;
  });
</script>

</body>
</html>
